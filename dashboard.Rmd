---
title: "CO2 Emission Dashboard"
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: fill
    theme: spacelab
vertical_layout: scroll
runtime: shiny
---

```{r setup, include=FALSE}
library(flexdashboard)
library(dplyr)
library(ggplot2)
library(miniUI)
library(DT)
#library(tidyverse)
countries_by_fuel = read.csv("E:\\co2-emissions-by-fuel-line.csv", header=TRUE)
countries_annual_co2_emission = read.csv("E:\\annual-co2-emissions-per-country.csv", header=TRUE)
```

CO2 Emission By Fossil Fuels{data-orientation=columns}
===================================

Column{.sidebar data-width=200}
-----------------------------------
```{r}
distinct_coutries_fuel = countries_by_fuel %>% distinct(Entity) %>% pull()
selectInput("country_choice", label = h4("Select Country"),
            choices = distinct_coutries_fuel, selected = "Afghanistan")
```

row {data-width=350}
---------------------------------
### Fossil Fuel CO2 Emissions{data-height=600}   

```{r, echo=FALSE}

miniContentPanel(
  renderPlot({
    input_df = countries_by_fuel %>% filter(Entity == input$country_choice)
    inputCountry <- paste(input$country_choice)
    ggplot(input_df, aes(x=Year))+
      geom_line(aes(y = CO2.emissions.from.oil, color="Oil"), size=1.5)+
      geom_line(aes(y = CO2.emissions.from.flaring, color="Flaring"), size=1.5)+
      geom_line(aes(y = CO2.emissions.from.cement, color="Cement"), size=1.5)+
      geom_line(aes(y = CO2.emissions.from.coal, color="Coal"), size=1.5)+
      geom_line(aes(y = CO2.emissions.from.gas, color="Gas"), size=1.5)+
      geom_line(aes(y = CO2.emissions.from.other.industry, color="Other Industry"), size=1.5)+
      scale_color_manual(values = c("darkred", "steelblue", "green", "darkorange", "#0036CC", "yellow"))+                          ggtitle(paste(inputCountry), "CO2 Emissions By fossil Fuels, Yearly") +
      labs(x="Year", y="CO2 Emissions from Fossil Fuels\n(metric tonnes per year)")+ 
      theme(axis.title.y = element_text(size=14, family="Trebuchet MS", color="#666666")) +
      theme(plot.title = element_text(size=26, family="Trebuchet MS", face="bold", hjust=0, color="#666666")) +
      theme(axis.text = element_text(size=16, family="Trebuchet MS"))
  }),
  

renderDT({
      input_df = countries_by_fuel %>% filter(Entity == input$country_choice)
      datatable(input_df, extensions = c('Responsive'), 
            options = list(responsive = TRUE))
}),scrollable = TRUE)

```

Per Capital CO2 Emissions {data-orientation=columns}
===================================

Row {data-height=650}
---------------------------------

### Overall Situation Since 
```{r}
```
Row {data-height=350}
---------------------------------

### New situations

```{r}
```

Global CO2 Emissions
====================================

Column{.sidebar data-width=200}
-----------------------------------

```{r}
distinct_coutries_annual_co2 = countries_annual_co2_emission %>% distinct(Entity) %>% pull()
selectInput("annual_country_choice", label = h4("Select Country"),
            choices = distinct_coutries_annual_co2, selected = "Afghanistan")

# observe({
#   annual_input_df = countries_annual_co2_emission %>% filter(Entity == input$annual_country_choice)
#   minValue = min(annual_input_df$Year)
#   maxValue = max(annual_input_df$Year)
#   stepValue = max(annual_input_df$Year) - min(annual_input_df$Year)
  
renderUI ({ 
  annual_input_df = countries_annual_co2_emission %>% filter(Entity == input$annual_country_choice)
    sliderValue = as.vector(annual_input_df$Year)
    print(as.numeric(max(annual_input_df$Year)) - as.numeric(min(annual_input_df$Year)))
            sliderInput("yearrange", label = "Year", 
            min = min(as.numeric(annual_input_df$Year)), 
            max = max(as.numeric(annual_input_df$Year)), 
            value = 100,
            animate = TRUE
            )})
```

Column{data-width=400}
-----------------------------------
### Chart A

```{r}
miniContentPanel(
  
  renderPlot({
      annual_input_df = countries_annual_co2_emission %>% filter(Entity == input$annual_country_choice)
      annual_input_df = annual_input_df %>% filter(Year <= input$yearrange)
      ggplot(data = annual_input_df, aes(x = Year, y = Annual.CO2.emissions))+
      geom_line(color = "#0099f9", size = 1) + geom_point(color = "#0099f9", size = 3)
  }),
  renderDT({
      annual_input_df = countries_annual_co2_emission %>% filter(Entity == input$annual_country_choice)
      annual_input_df = annual_input_df %>% filter(Year <= input$yearrange)
      datatable(annual_input_df, extensions = c('Responsive'), 
            options = list(responsive = TRUE))
}),scrollable = TRUE)

```

Column{data-width=400}
-----------------------------------
### Chart B

```{r}
renderPlot({
      annual_input_df = countries_annual_co2_emission %>% filter(Entity == input$annual_country_choice)
      annual_input_df = annual_input_df %>% filter(Year <= input$yearrange)
      ggplot(data = annual_input_df, aes(x = Year, y = Annual.CO2.emissions))+
          geom_bar(stat="identity", fill="white", color="blue")+
          theme_minimal()
})
```

### Chart C

```{r}
```
About US and Data{data-orientation=rows}
====================================

### About Us {data-height=300}

#### Team:
* Abhinav Tripathi 19BCE0548

<br>
<br>

#### About Data: 
  > CO2 Emission Data from Kaggle. 
  
  In this project we are using  CO2 and Greenhouse Emission data, which is downloaded from     kaggle.
  This dataset contains 55 columns and 20,000+ rows.
  This dataset contains year wise data of all the countries of the world. This dataset         includes wide range of information regarding CO2 emission (i.e. Growth rate, countries GDP,    CO2 emission per capita, etc.)

```{r}
```

